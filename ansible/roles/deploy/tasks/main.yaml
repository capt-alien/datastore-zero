- name: Ensure target namespace exists
  kubernetes.core.k8s:
    state: present
    definition:
      apiVersion: v1
      kind: Namespace
      metadata:
        name: "{{ target_namespace }}"
  environment:
    KUBECONFIG: /home/ubuntu/.kube/config

- name: Deploy backend app
  kubernetes.core.k8s:
    state: present
    definition: "{{ lookup('template', 'deployment.yaml.j2') }}"
  environment:
    KUBECONFIG: /home/ubuntu/.kube/config

- name: Expose backend service
  kubernetes.core.k8s:
    state: present
    definition: "{{ lookup('template', 'service.yaml.j2') }}"
  environment:
    KUBECONFIG: /home/ubuntu/.kube/config
